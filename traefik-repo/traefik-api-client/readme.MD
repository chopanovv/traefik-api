# Traefik-client

- Вытягивает с [traefik-api](../traefik/readme.MD) сертификаты и перезапускает нужный сервис

1. Можно запустить с указанием домена, это переназначит поведение, указанное в `.env`

**Пример**:

```
./getcert.sh domain.ru
```

2. Первый запуск создаст `.env` и заполнит его дефолтными параметрами, после чего скрипт завершит работу и попросит дозаполнить переменные.

**Нужно указать:**

```
API_SERVER=https://traefik-api.domain.ru/api/v1/certman/getcerts - полный путь к АПИ и методу
TOKEN= - токен
DOMAIN= - домен, сертификаты которого надо захватить
DEBUG=false - определяет уровень логирования curl
CERT_NAME=cert.pem - определяет имя файла создаваемого в нужной точке на сервере
KEY_NAME=key.pem - определяет имя файла создаваемого в нужной точке на сервере
PATH_TO_COPY=/etc/letsencrypt - определяет точку, куда нужно сложить сертификаты, без / на конце
SERVICE_RESTART=nginx - определяет какой сервис нужно рестартануть после подмены ключей
```

## Примечания
- Ключи не заменяются, если они идентичны.
- Сервис не перезапустится, если ключи не изменялись с моменты последнего импорта.
